<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="../../css/layui.css"  media="all">
    <title>Title</title>
</head>
<body>

<script src="../../layui.js"></script>
<script src="../../js/jquery.js"></script>
<script src="../../js/jquery.cookie.js"></script>
<script src="../../js/jquery.cookie.js"></script>
<div class="layui-container">

    <div class="layui-row">
        <fieldset class="layui-elem-field layui-field-title" style="margin-top: 30px;">
            <legend>成果展示</legend>
        </fieldset>
        <table class="layui-hide" id="photo" lay-filter="photo"></table>
    </div>
</div>
<script type="text/html" id="toolbarDemo">
        <button class="layui-btn layui-btn-sm" lay-event="getCheckData">添加成果</button>
        <div class="layui-inline" style="margin-left:80px">
            <input class="layui-input" id="queryContext" placeholder="请输入项目名">
        </div>
        <div class="layui-inline">
            <button class="layui-btn layui-btn-sm" lay-event="isAll" style="margin: auto">搜索</button>
        </div>

</script>
<script type="text/html" id="barDemo">
    <a class="layui-btn layui-btn-xs layui-btn-primary" lay-even="show">查看</a>
    <a class="layui-btn layui-btn-xs " lay-even="edit" >编辑</a>
    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-even="del" >删除</a>
</script>

<script>
    layui.use('table', function(){
        var table = layui.table;

        table.render({
            elem: '#photo'
            ,url:'http://localhost:8080/photograph/showPhoto.do'
            ,where:{
                labUserCookie: $.cookie("labUserCookie")
                ,sendUrl: window.location.href
            }
            ,toolbar: '#toolbarDemo'
            ,cellMinWidth: 80
            ,height: 500
            ,cols: [[
                {field:'photoId',  title: 'ID',width:80}
                ,{field:'subjectId', title: '所属项目',width:200}
                ,{field:'photoDes',  title: '成果描述'}
                ,{fixed:'right',  title: '操作',toolbar: '#barDemo',width:160}
            ]]
            ,page:true
        });
        //监听行工具事件
        table.on('tool(photo)', function(obj){
            var data = obj.data;
            var layEvent=obj.event;
            //console.log(obj)
            if(layEvent === 'del'){
                var photoId=data['photoId'];
                alert("del");
                $.ajax({
                    url:"http://localhost:8080/photograph/delPhoto.do",
                    type:"post",
                    data:{'photoId':photoId},
                    success:function(result){
                        if(result=="success"){
                            alert("删除成功");
                            location.reload();
                        }else {
                            alert("删除失败");
                        }
                    }
                });
            } else if(layEvent === 'edit'){
                alert("edit");
            }else if(layEvent === 'show'){
                alert("show");
            }
        });
    });
</script>
</body>
<script>

    $.ajax({
        type: "get",
        url: "http://localhost:8080/login/nothing.do",
        data: {
            labUserCookie: $.cookie("labUserCookie"),
            sendUrl:window.location.href
        },
        async: false,
        dataType: "json",
        success: function(data) {
            console.log(data);
            if(data.info == '404') {
                window.location.href = "../login/managerLogin.html";
            }
        }
    });
</script>
</html>